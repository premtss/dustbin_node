<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>Dustbin</title>
    <style>
      /* body {  
  background: #1D1F20;
  padding: 16px;
} */

canvas {
  border: 1px dotted red;
}

.chart-container {
  position: relative;
  margin: auto;
  height: 80vh;
  width: 80vw;
}

    </style>
</head>
<body>
  <select id="mySelect" onchange="myFunction()">
    <option value="2">2</option>
    <option value="5">5</option>
    <option value="10">10</option>
    <option value="15">15</option>
  </select>
    <h1>Welcome To Dustbin...!!</h1>
    <div id="datalist"></div>
    ===========================
   


    <!-- <div id="datalist1"></div> -->
    <div class="chart-container">
      <canvas id="chart"></canvas>
  </div>
  

  
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.4.1/jquery.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/2.5.0/Chart.min.js"></script>
    <script src="http://192.168.0.150:3002/socket.io/socket.io.js"></script>
<script>
  const socket = io('http://192.168.0.150:3002',{'forceNew':true });
  // var page=1; var status=false;
    socket.on('connect',function(data) {
         console.log("Server is connected");
       // var  record = document.getElementById("mySelect").value;
         //socket.emit('dustbinpickup',page,record,socket.id,false);
        // getData(socket,socket.id);
     });
   
  //   function myFunction(status) {
  //    var record = document.getElementById("mySelect").value;
  //     console.log(record);
  //       socket.emit('dustbinpickup',page,record,socket.id,true);
  //       getData(socket,socket.id);

  //    }
   
  // function getData(socket,id){
  //   $("#datalist1").html('');
  //  socket.on('dustbinpickup',(dataSet,id)=>{   
  //    $("#datalist1").html('');
  //    if(dataSet.length!=0){
  //          for(var xxi=0;xxi<dataSet.data.length;xxi++){ 
  //          $("#datalist1").append('<div>GSM:'+dataSet.data[xxi].gsm_moblie_number+' <span>DataPercentage:'+dataSet.data[xxi].data_percentage+'</span></div>');
  //      }  
  //    }
  //  });  
  // }
 
var dustbinname=[];
var dustbinData=[];
//var data;
  socket.on('dustbinpickup1', (dataSet)=>{
    dustbinname=[];
    dustbinData=[];
      if(dataSet.length!=0){
       
        for(var x=0;x<dataSet.length;x++){
        
          for(var xx=0;xx<dataSet[x].data.length;xx++){
            dustbinData.push(dataSet[x].data[xx].data_percentage);
            dustbinname.push(dataSet[x].data[xx].gsm_moblie_number);
           }
        }
        GetAll(dustbinname,dustbinData)
      }

      
    });
    function GetAll(Name,Data) 
    {
      var data = {
  labels: Name,
  datasets: [{
    label: "Dataset #1",
    backgroundColor: "rgba(255,99,132,0.2)",
    borderColor: "rgba(255,99,132,1)",
    borderWidth: 2,
    hoverBackgroundColor: "rgba(255,99,132,0.4)",
    hoverBorderColor: "rgba(255,99,132,1)",
    data: Data,
  }]
};
 
var options = {
  maintainAspectRatio: false,
  scales: {
    yAxes: [{
      stacked: true,
      gridLines: {
        display: true,
        color: "rgba(255,99,132,0.2)"
      }
    }],
    xAxes: [{
      gridLines: {
        display: false
      }
    }]
  }
};

Chart.Bar('chart', {
  options: options,
  data: data
});

      }
 console.log(dustbinname);
  


</script>
</body>
</html>